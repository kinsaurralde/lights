<html>

<head>
    <title>Lights</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="../static/main/main.css">
    <link rel="shortcut icon" href="{{ url_for('static', filename='img/favicon.ico') }}">
    <script src="../../../static/libs/socket.io.js"></script>
    <script src="../static/writehtml.js"></script>
    <script src="../static/sender.js"></script>
    <script src="../static/index/actions.js"></script>
    <script src="../static/index/controllers.js"></script>

</head>

<body>
    <div id="page-title">Lights</div>

    <div class="section" id="controllers">
        <div class="section-title">Controllers<input type="button" class="expand-button" value="^" style="width: 2vw;" onclick="expand('controllers','block')"></div>
        <div class="space-1"></div>
        <div class="section-hidden" id="controllers-expanded" style="display: block;">
        <div class="divider"></div>
        <div class="space-1"></div>
        {{vcontrollers}}
        <table id="controller_table">
            <tr>
                <th>Name</th>
                <th>Brightness Slider</th>
                <th>Cur/Max Brightness</th>
                <th>Num Pixels</th>
                <th>Pixel Sections</th>
                <th>Send</th>
            </tr>
            {% for v in vcontrollers %}
                {% set vid = v['vid'] %}
                {% if v['real'] == True %}
                    {% set cid = vid[:-8] %}
                    {% set id = 'controller_' + cid + '_' %}
                    {% for c in controllers %}
                        {% if c["controller_id"] == cid %}
                            <tr>
                                <td>{{c["controller_id"]}}</td>
                                <td><input id="{{id}}brightness_slider" type="range" min="0" max="{{c['neopixels']['max_brightness']}}" step="1" value="{{c['neopixels']['brightness']}}" oninput="controllers.send_brightness('{{cid}}')"></td>
                                <td><span id="{{id}}brightness">{{c["neopixels"]["brightness"]}}</span> / {{c["neopixels"]["max_brightness"]}}</td>
                                <td>{{c["neopixels"]["num_pixels"]}}</td>
                                <td>{{c["controller_id"]}}: ALL</td>
                                <td><input type="checkbox" id="{{id}}send" oninput="controllers.set_send('{{cid}}')" checked></td>
                            </tr>
                        {% endif %}
                    {% endfor %}                 
                {% else %}
                    <tr>
                        <td>{{vid}}</td>
                        <td>---</td>
                        <td>---</td>
                        <td>{{v['led_count']}}</td>
                        <td>
                            {% if vid == "ALL" %}
                                ALL
                            {% else %}
                                {% for s in v['controller_info'] %}
                                    {{s['id']}}: {{s['start']}} - {{s['end']}}
                                {% endfor %}
                            {% endif %}
                        </td>
                        <td><input type="checkbox" id="controller_{{vid}}_send" oninput="controllers.set_send('{{vid}}')"></td>
                    </tr>
                {% endif %}
            {% endfor %}
        </table>
    </div>
    </div>

    <div class="section" id="quick">
        <div class="section-title">Quick Actions<input type="button" class="expand-button" value="^" style="width: 2vw;"
                onclick="expand('quick','block')"></div>
        <div class="space-1"></div>
        <div class="section-hidden" id="quick-expanded" style="display: block;">
            <div class="divider"></div>
            {% for r in quick_actions["settings"]["rows"]%}
                <div>{{r["title"]}}</div>
                {% for b in r["buttons"] %}
                    {% if b in quick_actions["actions"] %}
                        <input type="button" value="{{quick_actions['actions'][b]['display']}}" onclick="actions.send_action('{{b}}')">
                    {% endif %}
                {% endfor %}
            {% endfor %}
        </div>
    </div>

    <div class="section" id="info">
        <input type="button" value="View Code" onclick="openURL('https:\/\/github.com/kinsaurralde/ws_281x-lights')">
        <input type="button" value="View Status" onclick="openURL('info/web')">
        <input type="button" value="View New Status" onclick="openURL('info/new_web')">
        <input type="button" value="kinsaurralde.com" onclick="openURL('https:\/\/kinsaurralde.com')">
    </div>

    <script>
        let sender = new Sender();
        let actions = new Actions(sender);
        let controllers = new Controllers(sender);

        function openURL(url) {
            window.open(url, "_blank");
        }

        function expand(id, displayType) {
            let target = document.getElementById(id + "-expanded");
            if (target.style.display == "none") {
                target.style.display = displayType;
            } else {
                target.style.display = "none";
            }
        }
    </script>

   
</body>

</html>